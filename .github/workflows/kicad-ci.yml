name: KiCad PCB Export

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  kicad-export:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install KiCad
        run: |
          sudo add-apt-repository --yes ppa:kicad/kicad-7.0-releases
          sudo apt update
          sudo apt install -y kicad

      - name: Export PCB files
        run: |
          for kicad in $(find pcb-design -name "*.kicad_pcb"); do
            echo "Exporting $kicad"
            pcbnew-cli export gerbers "$kicad" --directory gerbers
          done
